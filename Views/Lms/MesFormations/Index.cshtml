@model List<MangoTaikaDistrict.Domain.Entities.InscriptionFormation>
@{
    ViewData["Title"] = "Mes formations";
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2 class="fw-bold mb-1"><i class="bi bi-book me-2 text-primary"></i>Mes formations</h2>
        <p class="text-muted mb-0">Suivez votre progression dans les formations</p>
    </div>
    <a asp-controller="Formations" asp-action="Index" class="btn btn-outline-primary btn-modern">
        <i class="bi bi-plus-circle me-1"></i>Nouvelles formations
    </a>
</div>

@if (TempData["Success"] != null)
{
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        <i class="bi bi-check-circle me-2"></i>@TempData["Success"]
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
}

<div class="row g-4">
    @foreach (var inscription in Model)
    {
        var progression = inscription.Progressions.Count(p => p.EstComplete);
        var totalModules = inscription.Formation.Modules.Count;
        var pourcentage = totalModules > 0 ? (progression * 100 / totalModules) : 0;

        <div class="col-md-6">
            <div class="card-modern card h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-3">
                        <h5 class="card-title mb-0">@inscription.Formation.Titre</h5>
                        <span class="badge @(inscription.Statut == MangoTaikaDistrict.Domain.Enums.StatutInscription.COMPLETE ? "bg-success" : inscription.Statut == MangoTaikaDistrict.Domain.Enums.StatutInscription.EN_COURS ? "bg-info" : "bg-secondary")">
                            @inscription.Statut
                        </span>
                    </div>
                    <p class="text-muted small mb-3">@inscription.Formation.Description</p>
                    
                    <div class="mb-3">
                        <div class="d-flex justify-content-between mb-1">
                            <small class="text-muted">Progression</small>
                            <small class="text-muted">@progression / @totalModules modules</small>
                        </div>
                        <div class="progress" style="height: 8px;">
                            <div class="progress-bar @(inscription.Statut == MangoTaikaDistrict.Domain.Enums.StatutInscription.COMPLETE ? "bg-success" : "bg-primary")" 
                                 role="progressbar" style="width: @pourcentage%" 
                                 aria-valuenow="@pourcentage" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                    </div>

                    <div class="d-flex gap-2">
                        <a asp-action="Suivre" asp-route-inscriptionId="@inscription.Id" class="btn btn-primary btn-sm flex-grow-1">
                            <i class="bi bi-play-circle me-1"></i>Continuer
                        </a>
                        @if (inscription.Statut == MangoTaikaDistrict.Domain.Enums.StatutInscription.COMPLETE && inscription.Certificats.Any(c => c.EstValide))
                        {
                            <a href="@inscription.Certificats.First(c => c.EstValide).UrlCertificat" target="_blank" class="btn btn-outline-success btn-sm">
                                <i class="bi bi-award me-1"></i>Certificat
                            </a>
                        }
                    </div>
                </div>
            </div>
        </div>
    }
</div>

@if (!Model.Any())
{
    <div class="text-center py-5">
        <i class="bi bi-inbox fs-1 text-muted d-block mb-3"></i>
        <p class="text-muted">Vous n'êtes inscrit à aucune formation</p>
        <a asp-controller="Formations" asp-action="Index" class="btn btn-primary">
            <i class="bi bi-plus-circle me-1"></i>Parcourir les formations
        </a>
    </div>
}
