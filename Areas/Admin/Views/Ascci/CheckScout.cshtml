@model MangoTaikaDistrict.Domain.Entities.Scout
@{
    ViewData["Title"] = "Vérifier statut ASCCI";
    var existingStatus = ViewBag.ExistingStatus as MangoTaikaDistrict.Domain.Entities.AscciStatus;
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="fw-bold mb-0"><i class="bi bi-shield-check me-2 text-primary"></i>Vérifier statut ASCCI</h2>
    <a asp-action="Index" class="btn btn-outline-secondary">
        <i class="bi bi-arrow-left me-1"></i>Retour
    </a>
</div>

<div class="card-modern card mb-4">
    <div class="card-header bg-info text-white">
        <h5 class="mb-0">Informations du scout</h5>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-6">
                <p><strong>Nom :</strong> @Model.Nom @Model.Prenoms</p>
                <p><strong>Matricule :</strong> @(Model.Matricule ?? "-")</p>
                <p><strong>Groupe :</strong> @(Model.Groupe?.Nom ?? "-")</p>
            </div>
            <div class="col-md-6">
                <p><strong>Branche :</strong> @(Model.Unite?.Branche ?? "-")</p>
                <p><strong>Statut :</strong> <span class="badge bg-info">@Model.Statut</span></p>
            </div>
        </div>
    </div>
</div>

<div class="card-modern card">
    <div class="card-header bg-primary text-white">
        <h5 class="mb-0">Vérification statut ASCCI</h5>
    </div>
    <div class="card-body">
        @if (existingStatus != null)
        {
            <div class="alert alert-info mb-4">
                <h6><i class="bi bi-info-circle me-2"></i>Dernière vérification</h6>
                <p class="mb-0">
                    Statut : <strong>@existingStatus.Statut</strong> | 
                    Vérifié le : <strong>@existingStatus.DateVerification?.ToString("dd/MM/yyyy")</strong> | 
                    Par : <strong>@existingStatus.VerifiePar?.Nom</strong>
                </p>
            </div>
        }

        <form method="post" asp-action="UpdateStatus">
            <input type="hidden" name="scoutId" value="@Model.Id" />

            <div class="mb-3">
                <label class="form-label fw-semibold">Numéro de carte ASCCI</label>
                <input type="text" name="numeroCarte" class="form-control form-modern" 
                       value="@existingStatus?.NumeroCarte" 
                       placeholder="Ex: ASCCI-2026-001234" />
            </div>

            <div class="mb-3">
                <label class="form-label fw-semibold">Statut *</label>
                <select name="statut" class="form-select form-modern" required>
                    @{
                        var currentStatut = existingStatus?.Statut ?? "";
                    }
                    @if (currentStatut == "Non vérifié")
                    {
                        <option value="Non vérifié" selected>Non vérifié</option>
                    }
                    else
                    {
                        <option value="Non vérifié">Non vérifié</option>
                    }
                    @if (currentStatut == "Valide")
                    {
                        <option value="Valide" selected>Valide</option>
                    }
                    else
                    {
                        <option value="Valide">Valide</option>
                    }
                    @if (currentStatut == "Expiré")
                    {
                        <option value="Expiré" selected>Expiré</option>
                    }
                    else
                    {
                        <option value="Expiré">Expiré</option>
                    }
                    @if (currentStatut == "Invalide")
                    {
                        <option value="Invalide" selected>Invalide</option>
                    }
                    else
                    {
                        <option value="Invalide">Invalide</option>
                    }
                </select>
            </div>

            <div class="mb-3">
                <label class="form-label fw-semibold">Date d'expiration</label>
                <input type="date" name="dateExpiration" class="form-control form-modern" 
                       value="@(existingStatus?.DateExpiration?.ToString("yyyy-MM-dd") ?? "")" />
                <small class="text-muted">Date d'expiration de la carte ASCCI</small>
            </div>

            <div class="mb-3">
                <label class="form-label fw-semibold">Observations</label>
                <textarea name="observations" class="form-control form-modern" rows="3">@existingStatus?.Observations</textarea>
            </div>

            <div class="alert alert-warning">
                <i class="bi bi-info-circle me-2"></i>
                <strong>Note :</strong> Pour une vérification automatique via API, contactez l'ASCCI pour obtenir l'accès à leur API de vérification.
                En attendant, vous pouvez vérifier manuellement via la <a href="https://adhesion.scoutascci.org/" target="_blank">plateforme SYGESCA</a>.
            </div>

            <div class="d-flex justify-content-end gap-2">
                <a asp-action="Index" class="btn btn-outline-secondary">Annuler</a>
                <button type="submit" class="btn btn-primary btn-modern">
                    <i class="bi bi-save me-1"></i>Enregistrer
                </button>
            </div>
        </form>
    </div>
</div>
